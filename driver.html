<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
    const supabaseUrl = 'https://bimhfmxsikxyeaukfvbe.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJpbWhmbXhzaWt4eWVhdWtmdmJlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA1ODA2MTMsImV4cCI6MjA4NjE1NjYxM30.Q4Hydin8FSNIPd02Cl3e7RUSX6a_aEwJHBuh-Jwhmtg';
    
    // CORRECCIÓN: Cambiado el nombre de la variable a 'supabaseClient'
    const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);
    
    const mi_id = 1; 

    async function actualizarUbicacion(lat, lng) {
        const { error } = await supabaseClient // Usar el nombre corregido
            .from('repartidores')
            .update({ lat: lat, lng: lng, updated_at: new Date() })
            .eq('id', mi_id);

        if (error) {
            console.error('Error Supabase:', error.message);
            document.getElementById('status').innerText = "Error de conexión";
        } else {
            document.getElementById('status').innerText = `Enviado: ${lat}, ${lng}`;
        }
    }

    if (navigator.geolocation) {
        navigator.geolocation.watchPosition((position) => {
            actualizarUbicacion(position.coords.latitude, position.coords.longitude);
        }, (error) => {
            console.error("Error GPS:", error.message);
            document.getElementById('status').innerText = "Error GPS: " + error.message;
        }, {
            enableHighAccuracy: true,
            timeout: 10000,
            maximumAge: 0
        });
    } else {
        alert("Navegador no compatible");
    }
</script>
