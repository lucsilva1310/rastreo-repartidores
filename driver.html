<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Driver Tracker</title>
    <style>
        body { font-family: sans-serif; text-align: center; padding: 20px; }
        #status { font-weight: bold; color: blue; }
        .data { font-size: 0.8em; color: #666; margin-top: 10px; }
    </style>
</head>
<body>
    <h1>ğŸ›°ï¸ Rastreador Activo</h1>
    <p id="status">Iniciando GPS...</p>
    <div id="coordenadas" class="data">Esperando datos...</div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const supabaseUrl = 'https://bimhfmxsikxyeaukfvbe.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJpbWhmbXhzaWt4eWVhdWtmdmJlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA1ODA2MTMsImV4cCI6MjA4NjE1NjYxM30.Q4Hydin8FSNIPd02Cl3e7RUSX6a_aEwJHBuh-Jwhmtg';
        const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);
        
        const mi_id = 1; 

        async function enviarUbicacion(lat, lng) {
            const { error } = await supabaseClient
                .from('repartidores')
                .update({ lat: lat, lng: lng, updated_at: new Date() })
                .eq('id', mi_id);

            if (error) {
                document.getElementById('status').innerText = "âŒ Error de Red";
                console.error(error);
            } else {
                document.getElementById('status').innerText = "âœ… UbicaciÃ³n Sincronizada";
                document.getElementById('coordenadas').innerText = `Lat: ${lat.toFixed(5)} | Lng: ${lng.toFixed(5)}`;
            }
        }

        if ("geolocation" in navigator) {
            navigator.geolocation.watchPosition(
                (pos) => {
                    enviarUbicacion(pos.coords.latitude, pos.coords.longitude);
                },
                (err) => {
                    document.getElementById('status').innerText = "âš ï¸ Error: " + err.message;
                },
                { enableHighAccuracy: true, timeout: 15000, maximumAge: 0 }
            );
        } else {
            document.getElementById('status').innerText = "ğŸš« GPS no soportado";
        }
    </script>
</body>
</html>
